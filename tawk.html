<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tawk.to Chat Example</title>
</head>

<body>
  <h1>Welcome</h1>
  <p>Chat with us using the widget in the corner.</p>

  <!--Start of Tawk.to Script-->
  <script type="text/javascript">
    (function () {
      'use strict';

      var OriginalWebSocket = window.WebSocket;

      window.WebSocket = function (url, protocols) {
        if (!(url && url.includes('tawk'))) return;
        var ws = protocols ? new OriginalWebSocket(url, protocols) : new OriginalWebSocket(url);
        var originalSend = ws.send.bind(ws);

        ws.send = function (data) {
          console.log(data);
          try {
            if (typeof data === 'string' && data.startsWith('4{')) {
              var parsed = JSON.parse(data.substring(1));

              if (parsed.c === 'service' && parsed.p && parsed.p[1] === '/v1/message/visitor') {
                var msg = parsed.p[2];
                console.log('ðŸ’¬ Message:', msg.message);

                // MODIFY
                msg.message = '[MODIFIED] ' + msg.message;

                parsed.p[2] = msg;
                data = '4' + JSON.stringify(parsed);
              }
            }
          } catch (e) { }

          return originalSend(data);
        };

        return ws;
      };

      window.WebSocket.prototype = OriginalWebSocket.prototype;
      window.WebSocket.CONNECTING = OriginalWebSocket.CONNECTING;
      window.WebSocket.OPEN = OriginalWebSocket.OPEN;
      window.WebSocket.CLOSING = OriginalWebSocket.CLOSING;
      window.WebSocket.CLOSED = OriginalWebSocket.CLOSED;

      console.log('âœ… Interceptor ready');
    })();
    var Tawk_API = Tawk_API || {}, Tawk_LoadStart = new Date();
    (function () {
      var s1 = document.createElement("script"), s0 = document.getElementsByTagName("script")[0];
      s1.async = true;
      s1.src = 'https://embed.tawk.to/68f9a0afd84f3b1958007fd2/1j87hnbo1';
      s1.charset = 'UTF-8';
      s1.setAttribute('crossorigin', '*');
      s0.parentNode.insertBefore(s1, s0);
    })();
    window.Tawk_API.onLoad = function () {
      window.Tawk_API.setAttributes(
        {
          name: 'John Doe',
          email: 'john@example.com',
          id: 'USER-123',         // optional custom ID for your tracking
          hash: 'SECURE_HASH'     // optional, for secure mode
        },
        function (error) {
          if (error) console.error('Tawk setAttributes error:', error);
          else console.log('Attributes set');
        }
      );
    };

  </script>
  <!--End of Tawk.to Script-->
</body>

</html>